name: Build LogiTrack Mobile

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - uses: actions/checkout@v4

      # 2ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯ JDK 17
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'zulu'

      # 3ï¸âƒ£ ØªØ«Ø¨ÙŠØª Node Ùˆ Dependencies (Ù„Ùˆ package-lock.json Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ØŒ npm install ÙŠÙˆÙ„Ø¯Ù‡)
      - name: Install Node Dependencies
        run: npm install

      # 4ï¸âƒ£ ØªÙ†Ø¸ÙŠÙ ÙƒØ§Ù…Ù„ Ù„Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      - name: Full Clean Environment
        run: |
          rm -rf dist
          rm -rf android
          rm -rf node_modules/.vite
          echo "ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©"

      # 5ï¸âƒ£ Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆÙŠØ¨
      - name: Build Web Assets
        run: npm run build

      # 6ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯ Capacitor Android Ø¬Ø¯ÙŠØ¯
      - name: Initialize Capacitor Android
        run: |
          npx cap add android || echo "Android platform already exists"
          npx cap sync android

      # 7ï¸âƒ£ Ø¨Ù†Ø§Ø¡ APK Ù„Ù„ØªØ¬Ø±Ø¨Ø©
      - name: Build Debug APK
        run: |
          cd android
          ./gradlew assembleDebug

      # 8ï¸âƒ£ Ø¨Ù†Ø§Ø¡ AAB (Release Bundle)
      - name: Build Release Bundle
        run: |
          cd android
          ./gradlew bundleRelease

      # 9ï¸âƒ£ Ø±ÙØ¹ APK Ù„Ù„ØªØ¬Ø±Ø¨Ø©
      - name: Upload Testing APK
        uses: actions/upload-artifact@v4
        with:
          name: LogiTrack-Debug-APK
          path: android/app/build/outputs/apk/debug/app-debug.apk

      # ğŸ”Ÿ Ø±ÙØ¹ AAB Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚ÙŠØ¹
      - name: Upload Play Store Bundle (AAB)
        uses: actions/upload-artifact@v4
        with:
          name: LogiTrack-PlayStore-AAB
          path: android/app/build/outputs/bundle/release/app-release-unsigned.aab
